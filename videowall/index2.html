<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Party Wall ‚Äî Retro TV</title>
<style>
*{box-sizing:border-box;margin:0;padding:0}
html,body{height:100%;background:black;color:white;font-family:"Arial","Helvetica",sans-serif;overflow:hidden}

/* background video */
video.bg{
  position:fixed;inset:0;width:100%;height:100%;
  object-fit:cover;z-index:0;filter:saturate(1.1) contrast(1.1) brightness(0.9);
}

/* crt overlay */
.crt{pointer-events:none;position:fixed;inset:0;z-index:2;
  background-image:linear-gradient(rgba(0,0,0,0.06)50%,rgba(0,0,0,0.03)50%);
  background-size:100% 4px;mix-blend-mode:overlay;
}
.vignette{position:fixed;inset:0;z-index:3;
  background:radial-gradient(ellipse at center,rgba(0,0,0,0)40%,rgba(0,0,0,0.45)100%);
  pointer-events:none;
}

/* main container */
.stage{
  position:fixed;inset:0;z-index:1;
  display:flex;align-items:center;justify-content:center;
  padding:64px 5% 96px 5%;
}

/* photo card */
.photo-card{
  position:relative;
  width:90vw;max-width:1400px;
  height:auto;
  max-height:calc(100vh - 64px - 96px);
  display:flex;align-items:center;justify-content:center;
  border-radius:24px;overflow:visible;
  background:transparent;
  box-shadow:0 20px 80px rgba(0,0,0,0.8);
  opacity: 0;
  visibility: hidden;
  pointer-events: none;
  transition: none;
}

.photo-card.preload{
  opacity:0;
  visibility:hidden;
  pointer-events:none;
  box-shadow:none !important;
  transition:none !important;
}

/* CRT & vignette */
.photo-crt, .photo-vignette{
  pointer-events:none;
  position:absolute;
  inset:0;
  border-radius:inherit;
  z-index:4;
}
.photo-crt{
  background-image:linear-gradient(rgba(0,0,0,0.06) 50%, rgba(0,0,0,0.03) 50%);
  background-size:100% 4px;
  mix-blend-mode:overlay;
  opacity:0.9;
  z-index:4;
}
.photo-vignette{
  background:radial-gradient(ellipse at center, rgba(0,0,0,0) 40%, rgba(0,0,0,0.45) 100%);
  z-index:5;
}

/* photo frame ‚Äî –£–ú–ï–ù–¨–®–ï–ù–û –∏ —Å –ø–∞—Ä–µ–Ω–∏–µ–º */
.photo-frame{
  position:relative;
  display:inline-flex;
  align-items:center;justify-content:center;
  padding:10px;
  background:rgba(0,0,0,0.35);
  border:8px solid rgba(255,0,80,0.95);
  border-radius:16px;
  box-shadow:0 8px 30px rgba(255,0,80,0.08);
  max-width:100%;
  max-height:100%;
  z-index:6;
  overflow:hidden;
  min-width:220px;
  min-height:140px;
  transform: scale(0.94);
  transform-origin: center;
  transition: width .28s ease, height .28s ease, box-shadow .28s ease;
}

/* === –Ø–í–ù–û–ï –ü–ê–†–ï–ù–ò–ï === */
.photo-frame.drifting {
  animation: drift 14s ease-in-out infinite alternate;
}

.photo-frame img{
  display:block;
  visibility:hidden;
  opacity:0;
  transition:opacity .22s ease;
  max-width:100%;
  max-height:calc(100vh - 64px - 96px - 40px);
  width:auto;
  height:auto;
  object-fit:contain;
  border-radius:8px;
  opacity: 0.98 !important;
}

.photo-card.preload .photo-frame,
.photo-card.preload .photo-crt,
.photo-card.preload .photo-vignette {
  opacity:0;
  visibility:hidden;
  transition: none !important;
}

/* –ê–Ω–∏–º–∞—Ü–∏–∏ –¥–≤–∏–∂–µ–Ω–∏—è */
@keyframes slideInLeft {
  from { transform: translateX(-100vw) scale(0.94); opacity: 0; }
  to   { transform: translateX(0) scale(0.94); opacity: 1; }
}
@keyframes slideInRight {
  from { transform: translateX(100vw) scale(0.94); opacity: 0; }
  to   { transform: translateX(0) scale(0.94); opacity: 1; }
}
@keyframes slideOutLeft {
  from { transform: translateX(0) scale(0.94); opacity: 1; }
  to   { transform: translateX(-100vw) scale(0.94); opacity: 0; }
}
@keyframes slideOutRight {
  from { transform: translateX(0) scale(0.94); opacity: 1; }
  to   { transform: translateX(100vw) scale(0.94); opacity: 0; }
}

/* CRT –º–µ—Ä—Ü–∞–Ω–∏–µ */
@keyframes crt-flicker {
  0%, 100% { opacity: 0; filter: brightness(0) contrast(1); }
  10%      { opacity: 0.2; filter: brightness(0.3) contrast(1.2); }
  20%      { opacity: 0; }
  30%      { opacity: 0.4; filter: brightness(0.6) contrast(1.3); }
  40%      { opacity: 0.1; }
  50%      { opacity: 0.7; filter: brightness(0.9) contrast(1.4); }
  60%      { opacity: 0.3; }
  70%      { opacity: 0.9; filter: brightness(1.1) contrast(1.5); }
  80%      { opacity: 0.5; }
  90%      { opacity: 1; filter: brightness(1) contrast(1); }
}

/* === –£–°–ò–õ–ï–ù–ù–û–ï –ü–ê–†–ï–ù–ò–ï === */
@keyframes drift {
  0%   { transform: scale(0.9) translateX(-100px); }
  100% { transform: scale(0.9) translateX(100px); }
}

.photo-card.animating {
  animation-fill-mode: forwards;
  animation-timing-function: cubic-bezier(0.22, 0.61, 0.36, 1);
}

/* ticker */
.ticker{
  position:fixed;left:5%;right:5%;bottom:3%;
  z-index:6;height:72px;border-radius:8px;overflow:hidden;
  display:flex;align-items:center;
  background:linear-gradient(90deg,rgba(255,0,64,0.8),rgba(255,140,0,0.5));
  border:2px solid rgba(255,80,120,0.25);
  box-shadow:0 0 24px rgba(255,0,64,0.15);
  opacity: 1;
  visibility: visible;
  transition: opacity 0.4s ease, visibility 0.4s ease;
}
.ticker.fade-out {
  opacity: 0;
  visibility: hidden;
}

.label{
  min-width:120px;text-align:center;font-weight:800;
  color:#fff;text-transform:uppercase;font-size:18px;
  border-right:2px solid rgba(255,255,255,0.1);padding-right:10px;margin-right:10px;
}
.marquee-wrap{flex:1;overflow:hidden;position:relative;}
.marquee{
  white-space:nowrap;display:inline-block;
  font-size:28px;font-weight:700;color:#ffdcdc;
  text-shadow:0 2px 8px rgba(0,0,0,0.8),0 0 18px rgba(255,34,85,0.5);
  padding-right:40px;
}
.marquee.initial {
  visibility: hidden;
}
.channel{
  position:fixed;left:5%;top:5%;z-index:6;
  color:#fff;font-weight:800;text-transform:uppercase;
  background:linear-gradient(90deg,#ff6b96,#ffb86b);
  padding:8px 12px;border-radius:6px;box-shadow:0 6px 20px rgba(0,0,0,0.5);
}

/* === QR –ö–û–î ‚Äî –ù–û–í–û–ï === */
.qr-container {
  position: fixed;
  right: 5%;
  top: 5%;
  z-index: 6;
  display: flex;
  align-items: center;
  gap: 12px;
}
.qr-code {
  width: 150px;
  height: 150px;
  border-radius: 8px;
  background: rgba(0,0,0,0.3);
  box-shadow: 0 4px 12px rgba(0,0,0,0.5);
  image-rendering: pixelated; /* –¥–ª—è —á—ë—Ç–∫–æ—Å—Ç–∏ QR */
}
.qr-code img {
  width: 100%;
  height: 100%;
  display: block;
  object-fit: contain;
}
</style>
</head>
<body>
<video class="bg" autoplay loop muted playsinline>
  <source src="party-bg6.mp4" type="video/mp4">
</video>

<div class="stage">
  <div id="photoCard" class="photo-card hidden">
    <div class="photo-crt" aria-hidden="true"></div>
    <div class="photo-vignette" aria-hidden="true"></div>
    <div class="photo-frame">
      <img id="mainPhoto" src="" alt="">
    </div>
  </div>
</div>

<div class="crt"></div>
<div class="vignette"></div>

<div class="channel">MAIS TV</div>

<div class="qr-container">
  <div class="qr-code">
    <img id="qrCode" src="qr-code.png" alt="QR –∫–æ–¥ –¥–ª—è Telegram">
  </div>
</div>

<div class="ticker">
  <div class="label">SMS-–ß–∞—Ç</div>
  <div class="marquee-wrap" id="marqueeWrap">
    <div id="marquee" class="marquee">&nbsp;</div>
  </div>
</div>

<script type="module">
console.log('üöÄ –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è Party Wall TV');

// 1. –ò–°–ü–†–ê–í–õ–ï–ù–ù–´–ï –ö–û–ù–°–¢–ê–ù–¢–´ –ë–ï–ó –õ–ò–®–ù–ò–• –ü–†–û–ë–ï–õ–û–í
const SUPABASE_URL = 'https://luqsmllrhasibqellhqo.supabase.co';
const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imx1cXNtbGxyaGFzaWJxZWxsaHFvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjIzNjE2MDksImV4cCI6MjA3NzkzNzYwOX0.00e-UFmmjosbJhWq3sFNhDCQdYEzO0ZHVrW3k4Cid7U';

// 2. –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø –ì–õ–û–ë–ê–õ–¨–ù–´–• –ü–ï–†–ï–ú–ï–ù–ù–´–•
const photoCard = document.getElementById('photoCard');
const mainPhoto = document.getElementById('mainPhoto');
const marquee = document.getElementById('marquee');
const marqueeWrap = document.getElementById('marqueeWrap');
const tickerEl = document.querySelector('.ticker');

let queue = [];
let showing = false;
let messageCounter = 0;

// 3. –§–£–ù–ö–¶–ò–ò –≠–ö–†–ê–ù–ò–†–û–í–ê–ù–ò–Ø
function esc(s){
  return s ? String(s).replace(/[&<>"']/g, m => ({
    '&': '&amp;',
    '<': '&lt;',
    '>': '&gt;',
    '"': '&quot;',
    "'": '&#39;'
  }[m])) : '';
}

// 4. –û–¢–û–ë–†–ê–ñ–ï–ù–ò–ï –°–û–û–ë–©–ï–ù–ò–ô
function showMessage(item, textOnly = false){
  const rawText = (item.text || '').trim();
  if (rawText.length < 4) {
    console.warn('‚úâÔ∏è –ü—Ä–æ–ø—É—â–µ–Ω–æ –∫–æ—Ä–æ—Ç–∫–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ:', rawText);
    return;
  }

  const text = `${esc(item.author || '–ê–Ω–æ–Ω–∏–º')}: ${esc(rawText)}`;
  
  // –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –±–µ–≥—É—â–µ–π —Å—Ç—Ä–æ–∫–∏
  marquee.classList.add('initial');
  marquee.innerHTML = `${text} &nbsp;     ‚Ä¢.     &nbsp; ${text}`;
  tickerEl.classList.remove('fade-out');

  if (textOnly) {
    console.log('üí¨ –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–µ–∫—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ:', text);
    startMarquee(item);
    
    setTimeout(() => {
      marquee.innerHTML = '&nbsp;';
      marquee.style.animation = 'none';
      showing = false;
      nextMessage();
    }, 10000);
    
    showing = true;
    return;
  }

  // –ü–û–î–ì–û–¢–û–í–ö–ê –§–û–¢–û–ö–ê–†–¢–´
  photoCard.classList.remove('hidden');
  photoCard.classList.add('preload');

  const frame = document.querySelector('.photo-frame');
  frame.style.width = '';
  frame.style.height = '';
  frame.classList.remove('drifting');

  mainPhoto.style.visibility = 'hidden';
  mainPhoto.style.opacity = '0';
  mainPhoto.src = item.image_url;

  const onLoaded = () => {
    console.log('üñºÔ∏è –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∑–∞–≥—Ä—É–∂–µ–Ω–æ:', item.image_url);
    
    const style = getComputedStyle(frame);
    const paddingX = parseFloat(style.paddingLeft || 0) + parseFloat(style.paddingRight || 0);
    const paddingY = parseFloat(style.paddingTop || 0) + parseFloat(style.paddingBottom || 0);
    const borderX = parseFloat(style.borderLeftWidth || 0) + parseFloat(style.borderRightWidth || 0);
    const borderY = parseFloat(style.borderTopWidth || 0) + parseFloat(style.borderBottomWidth || 0);

    const availableW = Math.max(40, photoCard.clientWidth - (paddingX + borderX));
    const availableH = Math.max(40, photoCard.clientHeight - (paddingY + borderY));

    const natW = mainPhoto.naturalWidth || availableW;
    const natH = mainPhoto.naturalHeight || availableH;
    const ratio = natW / natH || 1;

    let imgW = availableW;
    let imgH = Math.round(imgW / ratio);
    if (imgH > availableH) {
      imgH = availableH;
      imgW = Math.round(imgH * ratio);
    }

    const frameW = imgW + paddingX + borderX;
    const frameH = imgH + paddingY + borderY;

    frame.style.width = Math.max(frameW, parseFloat(getComputedStyle(frame).minWidth) || 0) + 'px';
    frame.style.height = Math.max(frameH, parseFloat(getComputedStyle(frame).minHeight) || 0) + 'px';

    photoCard.classList.remove('preload');

    // CRT —ç—Ñ—Ñ–µ–∫—Ç
    frame.style.animation = 'crt-flicker 1.8s steps(1) forwards';
    mainPhoto.style.visibility = 'visible';

    setTimeout(() => {
      mainPhoto.style.opacity = '0.9';
      frame.style.animation = '';
      frame.classList.add('drifting');

      messageCounter++;
      const isEven = messageCounter % 2 === 0;
      const inAnim = isEven ? 'slideInRight' : 'slideInLeft';
      const outAnim = isEven ? 'slideOutLeft' : 'slideOutRight';

      photoCard.style.animation = `${inAnim} 0.6s cubic-bezier(0.22, 0.61, 0.36, 1) forwards`;
      photoCard.classList.add('animating');

      setTimeout(() => {
        startMarquee(item);
      }, 150);

      setTimeout(() => {
        photoCard.style.animation = `${outAnim} 0.5s cubic-bezier(0.55, 0.09, 0.68, 0.53) forwards`;
        setTimeout(() => {
          photoCard.classList.remove('animating');
          photoCard.classList.add('hidden');
          mainPhoto.src = '';
          showing = false;
          nextMessage();
        }, 500);
      }, 10000);
    }, 1800);

    cleanup();
  };

  const onError = (e) => {
    console.error('üî• –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è:', e);
    cleanup();
    showMessage(item, true);
  };

  const cleanup = () => {
    mainPhoto.removeEventListener('load', onLoaded);
    mainPhoto.removeEventListener('error', onError);
  };

  mainPhoto.addEventListener('load', onLoaded);
  mainPhoto.addEventListener('error', onError);

  if (mainPhoto.complete && mainPhoto.naturalWidth) {
    setTimeout(onLoaded, 0);
  }

  showing = true;
}

// 5. –ó–ê–ü–£–°–ö –ë–ï–ì–£–©–ï–ô –°–¢–†–û–ö–ò
function startMarquee(item){
  console.log('üóûÔ∏è –ó–∞–ø—É—Å–∫ –±–µ–≥—É—â–µ–π —Å—Ç—Ä–æ–∫–∏');
  
  marquee.style.animation = 'none';
  marquee.style.transform = '';

  requestAnimationFrame(() => {
    const cw = marquee.scrollWidth;
    const vw = marqueeWrap.clientWidth;
    const spd = 160;
    const dur = Math.max(6, (cw + vw) / spd);
    
    const st = document.getElementById('marqStyle') || (() => {
      let s = document.createElement('style');
      s.id = 'marqStyle';
      document.head.appendChild(s);
      return s;
    })();

    st.textContent = `
      @keyframes move {
        0%   { transform: translateX(${vw}px); }
        100% { transform: translateX(-${cw}px); }
      }
    `;
    
    marquee.style.animation = `move ${dur}s linear infinite`;
    marquee.classList.remove('initial');
  });
}

// 6. –°–õ–ï–î–£–Æ–©–ï–ï –°–û–û–ë–©–ï–ù–ò–ï
function nextMessage(){
  console.log(`‚è≠Ô∏è –°–ª–µ–¥—É—é—â–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ. –û—á–µ—Ä–µ–¥—å: ${queue.length}, –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è: ${showing}`);
  
  if (showing || queue.length === 0) {
    tickerEl.classList.add('fade-out');
    return;
  }

  let item;
  let rawText;

  while (queue.length > 0) {
    item = queue.shift();
    if (!item) continue;
    
    rawText = (item.text || '').trim();
    if (rawText.length >= 4) {
      break;
    }
    item = null;
  }

  if (!item || rawText.length < 4) {
    console.log('‚èπÔ∏è –û—á–µ—Ä–µ–¥—å –ø—É—Å—Ç–∞');
    showing = false;
    tickerEl.classList.add('fade-out');
    return;
  }

  console.log('‚û°Ô∏è –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è:', item.id || '–±–µ–∑ ID');
  showing = true;
  const hasImage = !!(item.image_url && item.image_url.trim());
  
  if (hasImage) {
    showMessage(item, false);
  } else {
    showMessage(item, true);
  }
}

// 7. –ù–ê–î–ï–ñ–ù–ê–Ø –ó–ê–ì–†–£–ó–ö–ê SUPABASE
async function loadSupabase() {
  // –ü–æ–ø—ã—Ç–∫–∞ 1: –û—Å–Ω–æ–≤–Ω–æ–π CDN
  try {
    console.log('üì¶ –ó–∞–≥—Ä—É–∂–∞–µ–º Supabase –∏–∑ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ CDN...');
    const module = await import('https://esm.sh/@supabase/supabase-js@2.43.0');
    console.log('‚úÖ Supabase –∑–∞–≥—Ä—É–∂–µ–Ω —á–µ—Ä–µ–∑ esm.sh');
    return module;
  } catch (err1) {
    console.warn('‚ö†Ô∏è –û—Å–Ω–æ–≤–Ω–æ–π CDN –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª:', err1.message);
    
    // –ü–æ–ø—ã—Ç–∫–∞ 2: –†–µ–∑–µ—Ä–≤–Ω—ã–π CDN
    try {
      console.log('üì¶ –ü—Ä–æ–±—É–µ–º —Ä–µ–∑–µ—Ä–≤–Ω—ã–π CDN...');
      const module = await import('https://cdn.skypack.dev/@supabase/supabase-js@2.43.0');
      console.log('‚úÖ Supabase –∑–∞–≥—Ä—É–∂–µ–Ω —á–µ—Ä–µ–∑ Skypack');
      return module;
    } catch (err2) {
      console.error('üî• –í—Å–µ CDN –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã:', err2);
      throw new Error('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å Supabase');
    }
  }
}

// 8. –ù–ê–°–¢–†–û–ô–ö–ê REALTIME –ü–û–î–ö–õ–Æ–ß–ï–ù–ò–Ø
async function setupRealtime() {
  try {
    console.log('üîß –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Supabase');
    
    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
    if (!SUPABASE_URL || !SUPABASE_ANON_KEY) {
      throw new Error('‚ùå –û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç —É—á–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ Supabase');
    }

    // –ó–∞–≥—Ä—É–∑–∫–∞ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏
    const { createClient } = await loadSupabase();
    
    // –°–æ–∑–¥–∞–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞
    const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
    console.log('üîå –ü–æ–¥–∫–ª—é—á–µ–Ω–æ –∫ Supabase');

    // –ó–∞–≥—Ä—É–∑–∫–∞ –∏—Å—Ç–æ—Ä–∏–∏ —Å–æ–æ–±—â–µ–Ω–∏–π
    console.log('üì• –ó–∞–≥—Ä—É–∑–∫–∞ –∏—Å—Ç–æ—Ä–∏–∏ —Å–æ–æ–±—â–µ–Ω–∏–π...');
    const { data, error } = await supabase
      .from('messages')
      .select('*')
      .eq('approved', true)
      .order('timestamp', { ascending: true });
    
    if (error) throw error;
    
    if (data?.length) {
      console.log(`‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω–æ ${data.length} —Å–æ–æ–±—â–µ–Ω–∏–π`);
      queue.push(...data.reverse()); // –ù–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ –Ω–∞—á–∞–ª–æ –æ—á–µ—Ä–µ–¥–∏
      nextMessage();
    } else {
      console.log('üì≠ –ò—Å—Ç–æ—Ä–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π –ø—É—Å—Ç–∞');
      tickerEl.classList.add('fade-out');
    }

    // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ realtime-–ø–æ–¥–ø–∏—Å–∫–∏
    console.log('üì° –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ –Ω–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è...');
    const channel = supabase
      .channel('custom-all-channel')
      .on(
        'postgres_changes',
        { 
          event: 'INSERT', 
          schema: 'public',
          table: 'messages'
        },
        (payload) => {
          console.log('üîî –ù–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—É—á–µ–Ω–æ:', payload.new);
          if (payload.new?.approved) {
            queue.push(payload.new);
            tickerEl.classList.remove('fade-out');
            if (!showing) nextMessage();
          }
        }
      )
      .subscribe((status) => {
        console.log(`üì∂ –°—Ç–∞—Ç—É—Å –ø–æ–¥–ø–∏—Å–∫–∏: ${status}`);
        if (status === 'SUBSCRIBED') {
          console.log('‚úÖ –£—Å–ø–µ—à–Ω–∞—è –ø–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è');
        }
      });

  } catch (err) {
    console.error('üí• –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞:', err);
    // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø–æ–≤—Ç–æ—Ä–Ω–∞—è –ø–æ–ø—ã—Ç–∫–∞
    setTimeout(() => {
      console.log('üîÑ –ü–æ–≤—Ç–æ—Ä–Ω–∞—è –ø–æ–ø—ã—Ç–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è...');
      setupRealtime();
    }, 10000);
  }
}

// 9. –ì–ê–†–ê–ù–¢–ò–†–û–í–ê–ù–ù–ê–Ø –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø
document.addEventListener('DOMContentLoaded', () => {
  console.log('‚úÖ DOM –ø–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–≥—Ä—É–∂–µ–Ω');
  setupRealtime();
  
  // –ó–∞—â–∏—Ç–∞ –æ—Ç –∑–∞–≤–∏—Å–∞–Ω–∏—è
  setInterval(() => {
    if (!showing && queue.length > 0) {
      console.log('‚ôªÔ∏è –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∑–∞–ø—É—Å–∫ –æ—á–µ—Ä–µ–¥–∏');
      nextMessage();
    }
  }, 60000);
});
</script>
</body>
</html>
