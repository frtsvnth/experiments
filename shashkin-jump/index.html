<!DOCTYPE html>
<html lang="ru">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
	<meta name="apple-mobile-web-app-capable" content="yes">
	<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
	<meta name="theme-color" content="#1a2a6c">
	<title>Doodle Jump - Стабильная версия</title>
	<style>
		* {
			margin: 0;
			padding: 0;
			box-sizing: border-box;
			-webkit-tap-highlight-color: transparent;
			-webkit-touch-callout: none;
			-webkit-user-select: none;
			user-select: none;
		}

		body {
			font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
			background: #0a1a3a;
			display: flex;
			justify-content: center;
			align-items: center;
			min-height: 100vh;
			overflow: hidden;
			touch-action: manipulation;
		}

		#game-container {
			position: relative;
			width: 100%;
			max-width: 480px;
			height: 800px;
			margin: auto;
		}

		canvas {
			display: block;
			width: 100%;
			height: 100%;
			border-radius: 8px;
			image-rendering: crisp-edges;
		}

		.screen {
			position: absolute;
			top: 0;
			left: 0;
			width: 100%;
			height: 100%;
			display: flex;
			flex-direction: column;
			justify-content: center;
			align-items: center;
			background: linear-gradient(135deg, rgba(26, 42, 108, 0.95), rgba(16, 32, 80, 0.98));
			color: white;
			border-radius: 8px;
			z-index: 100;
			text-align: center;
			padding: 20px;
		}

		.screen.hidden {
			display: none !important;
		}

		h1 {
			font-size: 3.5rem;
			margin-bottom: 20px;
			background: linear-gradient(45deg, #FF6B6B, #4ECDC4);
			-webkit-background-clip: text;
			background-clip: text;
			color: transparent;
			font-weight: 800;
			letter-spacing: 1px;
		}

		.subtitle {
			font-size: 1.4rem;
			margin-bottom: 30px;
			color: #e0e0ff;
			line-height: 1.4;
		}

		.score-display {
			font-size: 2.8rem;
			margin: 20px 0;
			color: #FFD166;
			font-weight: bold;
		}

		.btn {
			background: linear-gradient(145deg, #FF6B6B, #EE5A5A);
			color: white;
			border: none;
			padding: 15px 40px;
			font-size: 1.5rem;
			border-radius: 50px;
			margin: 10px;
			cursor: pointer;
			transition: transform 0.2s;
			box-shadow: 0 6px 20px rgba(255, 107, 107, 0.4);
			font-weight: 600;
		}

		.btn:hover {
			transform: scale(1.05);
		}

		.btn.secondary {
			background: linear-gradient(145deg, #4ECDC4, #3AADA0);
		}

		.instructions {
			background: rgba(30, 45, 90, 0.7);
			border-radius: 15px;
			padding: 20px;
			margin-top: 20px;
		}

		.instructions h3 {
			color: #4ECDC4;
			margin-bottom: 10px;
			font-size: 1.4rem;
		}

		.instructions p {
			color: #e0e0ff;
			line-height: 1.5;
		}

		.record {
			position: absolute;
			top: 20px;
			left: 50%;
			transform: translateX(-50%);
			background: rgba(0, 0, 0, 0.7);
			color: #FFD166;
			padding: 10px 20px;
			border-radius: 25px;
			font-weight: bold;
			font-size: 1.3rem;
			z-index: 50;
		}

		.touch-controls {
			position: absolute;
			bottom: 70px;
			left: 0;
			width: 100%;
			display: flex;
			justify-content: space-around;
			z-index: 30;
			padding: 0 20px;
		}

		.touch-btn {
			width: 80px;
			height: 80px;
			border-radius: 50%;
			background: rgba(255, 255, 255, 0.15);
			backdrop-filter: blur(10px);
			border: 3px solid rgba(255, 255, 255, 0.3);
			display: flex;
			align-items: center;
			justify-content: center;
			font-size: 2.5rem;
			color: white;
			cursor: pointer;
			user-select: none;
		}

		@media (max-width: 480px) {
			#game-container {
				height: 100vh;
				max-width: 100vw;
			}

			canvas {
				border-radius: 0;
			}

			.screen {
				border-radius: 0;
			}

			h1 {
				font-size: 2.5rem;
			}

			.touch-btn {
				width: 70px;
				height: 70px;
				font-size: 2rem;
			}
		}
	</style>
</head>

<body>
	<div id="game-container">
		<canvas id="gameCanvas" width="480" height="800"></canvas>

		<div id="menu-screen" class="screen">
			<h1>DOODLE JUMP</h1>
			<p class="subtitle">Прыгай по платформам и поднимайся как можно выше!</p>
			<button id="start-btn" class="btn">НАЧАТЬ ИГРУ</button>
			<div class="instructions">
				<h3>УПРАВЛЕНИЕ</h3>
				<p>Кнопки внизу или клавиши ← → на клавиатуре</p>
			</div>
		</div>

		<div id="game-over-screen" class="screen hidden">
			<h1>ИГРА ОКОНЧЕНА</h1>
			<div class="score-display">ВЫСОТА: <span id="final-score">0</span></div>
			<div class="score-display">РЕКОРД: <span id="record-score">0</span></div>
			<button id="restart-btn" class="btn">ИГРАТЬ СНОВА</button>
			<button id="menu-btn" class="btn secondary">В МЕНЮ</button>
		</div>

		<div id="record-display" class="record hidden">РЕКОРД: 0</div>

		<div class="touch-controls">
			<div id="left-btn" class="touch-btn">←</div>
			<div id="right-btn" class="touch-btn">→</div>
		</div>
	</div>

	<script>
		// ===========================================================
        // ОСНОВНЫЕ КОНСТАНТЫ И ПЕРЕМЕННЫЕ
        // ===========================================================
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        
        const GAME_STATES = {
            MENU: 'menu',
            PLAYING: 'playing',
            GAME_OVER: 'game_over'
        };
        
        const SCREEN_WIDTH = 480;
        const SCREEN_HEIGHT = 800;
        
        // DOM элементы
        const menuScreen = document.getElementById('menu-screen');
        const gameOverScreen = document.getElementById('game-over-screen');
        const finalScoreDisplay = document.getElementById('final-score');
        const recordScoreDisplay = document.getElementById('record-score');
        const recordDisplay = document.getElementById('record-display');
        const startBtn = document.getElementById('start-btn');
        const restartBtn = document.getElementById('restart-btn');
        const menuBtn = document.getElementById('menu-btn');
        const leftBtn = document.getElementById('left-btn');
        const rightBtn = document.getElementById('right-btn');
        
        // Игровые переменные
        let gameState = GAME_STATES.MENU;
        let platforms = [];
        let coins = [];
        let particles = [];
        let score = 0;
        let highScore = parseInt(localStorage.getItem('doodleJumpHighScore') || '0');
        let cameraY = 0;
        let cameraTargetY = 0;
        
        // ===========================================================
        // КЛАСС ИГРОКА
        // ===========================================================
        class Player {
            constructor() {
                this.reset();
            }
            
            reset() {
                this.x = SCREEN_WIDTH / 2 - 20;
                this.y = 650;
                this.width = 40;
                this.height = 50;
                this.velX = 0;
                this.velY = 0;
                this.speed = 6;
                this.jumpPower = -15;
                this.gravity = 0.6;
                this.maxFallSpeed = 20;
                this.facingRight = true;
                this.grounded = false;
                this.color = '#FF6B6B';
            }
            
            update(input) {
                // Горизонтальное движение
                this.velX = 0;
                if (input.left) {
                    this.velX = -this.speed;
                    this.facingRight = false;
                }
                if (input.right) {
                    this.velX = this.speed;
                    this.facingRight = true;
                }
                
                // Применяем гравитацию
                this.velY += this.gravity;
                if (this.velY > this.maxFallSpeed) {
                    this.velY = this.maxFallSpeed;
                }
                
                // Обновляем позицию
                this.x += this.velX;
                this.y += this.velY;
                
                // Телепортация через края
                if (this.x + this.width < 0) {
                    this.x = SCREEN_WIDTH;
                } else if (this.x > SCREEN_WIDTH) {
                    this.x = -this.width;
                }
                
                this.grounded = false;
            }
            
            draw() {
                const y = this.y - cameraY;
                
                // Тело
                ctx.fillStyle = this.facingRight ? '#FF6B6B' : '#4ECDC4';
                ctx.fillRect(this.x, y, this.width, this.height * 0.8);
                
                // Голова
                ctx.fillStyle = '#FFD9B3';
                ctx.fillRect(this.x + 8, y - 15, this.width - 16, 20);
                
                // Глаза
                ctx.fillStyle = '#000';
                if (this.facingRight) {
                    ctx.fillRect(this.x + 25, y - 8, 6, 8);
                    ctx.fillRect(this.x + 35, y - 8, 6, 8);
                } else {
                    ctx.fillRect(this.x + 15, y - 8, 6, 8);
                    ctx.fillRect(this.x + 5, y - 8, 6, 8);
                }
                
                // Рот
                ctx.fillStyle = '#E74C3C';
                ctx.fillRect(this.x + 15, y + 5, 10, 3);
                
                // Ноги
                ctx.fillStyle = '#3498DB';
                ctx.fillRect(this.x + 5, y + this.height * 0.8 - 5, 10, 10);
                ctx.fillRect(this.x + 25, y + this.height * 0.8 - 5, 10, 10);
            }
        }
        
        // ===========================================================
        // КЛАСС ПЛАТФОРМЫ
        // ===========================================================
        class Platform {
            constructor(x, y, type = 'normal') {
                this.x = x;
                this.y = y;
                this.width = 80;
                this.height = 15;
                this.type = type;
                this.id = Math.random();
                
                if (type === 'moving') {
                    this.direction = Math.random() > 0.5 ? 1 : -1;
                    this.speed = 2;
                    this.minX = 20;
                    this.maxX = SCREEN_WIDTH - this.width - 20;
                }
                
                if (type === 'breakable') {
                    this.health = 3;
                }
            }
            
            update() {
                if (this.type === 'moving') {
                    this.x += this.speed * this.direction;
                    if (this.x <= this.minX || this.x + this.width >= this.maxX) {
                        this.direction *= -1;
                    }
                }
            }
            
            draw() {
                const y = this.y - cameraY;
                
                // Не рисуем, если платформа за пределами экрана
                if (y > SCREEN_HEIGHT + 100 || y < -100) return;
                
                // Цвет платформы
                switch(this.type) {
                    case 'normal': ctx.fillStyle = '#7986CB'; break;
                    case 'moving': ctx.fillStyle = '#4DB6AC'; break;
                    case 'breakable': ctx.fillStyle = '#E57373'; break;
                    case 'spring': ctx.fillStyle = '#81C784'; break;
                }
                
                // Рисуем платформу
                ctx.fillRect(this.x, y, this.width, this.height);
                
                // Тень
                ctx.fillStyle = 'rgba(0, 0, 0, 0.3)';
                ctx.fillRect(this.x, y + this.height - 3, this.width, 3);
                
                // Детали для пружины
                if (this.type === 'spring') {
                    ctx.fillStyle = '#388E3C';
                    ctx.fillRect(
                        this.x + this.width / 2 - 15,
                        y - 25,
                        30,
                        25
                    );
                    
                    // Полоски на пружине
                    ctx.fillStyle = '#1B5E20';
                    ctx.fillRect(this.x + this.width / 2 - 13, y - 20, 26, 3);
                    ctx.fillRect(this.x + this.width / 2 - 13, y - 10, 26, 3);
                }
            }
        }
        
        // ===========================================================
        // КЛАСС МОНЕТЫ
        // ===========================================================
        class Coin {
            constructor(x, y) {
                this.x = x;
                this.y = y;
                this.width = 20;
                this.height = 20;
                this.collected = false;
                this.rotation = 0;
                this.floatOffset = Math.random() * Math.PI * 2;
            }
            
            update() {
                this.rotation += 0.05;
                this.floatOffset += 0.03;
            }
            
            draw() {
                if (this.collected) return;
                
                const y = this.y - cameraY;
                if (y > SCREEN_HEIGHT + 50 || y < -50) return;
                
                const floatY = y + Math.sin(this.floatOffset) * 5;
                
                ctx.save();
                ctx.translate(this.x + this.width / 2, floatY + this.height / 2);
                ctx.rotate(this.rotation);
                
                // Монета
                ctx.fillStyle = '#FFD166';
                ctx.beginPath();
                ctx.arc(0, 0, this.width / 2, 0, Math.PI * 2);
                ctx.fill();
                
                // Блик
                ctx.fillStyle = '#FFF9C4';
                ctx.beginPath();
                ctx.arc(-3, -3, 4, 0, Math.PI * 2);
                ctx.fill();
                
                ctx.restore();
            }
        }
        
        // ===========================================================
        // КЛАСС ЧАСТИЦЫ
        // ===========================================================
        class Particle {
            constructor(x, y, color) {
                this.x = x;
                this.y = y;
                this.size = 2 + Math.random() * 4;
                this.velX = -2 + Math.random() * 4;
                this.velY = -3 - Math.random() * 2;
                this.color = color;
                this.life = 30 + Math.random() * 20;
            }
            
            update() {
                this.x += this.velX;
                this.y += this.velY;
                this.velY += 0.2;
                this.life--;
            }
            
            draw() {
                const y = this.y - cameraY;
                if (y > SCREEN_HEIGHT + 50 || y < -50) return;
                
                ctx.globalAlpha = this.life / 50;
                ctx.fillStyle = this.color;
                ctx.beginPath();
                ctx.arc(this.x, y, this.size, 0, Math.PI * 2);
                ctx.fill();
                ctx.globalAlpha = 1;
            }
        }
        
        // ===========================================================
        // ИНИЦИАЛИЗАЦИЯ ИГРЫ
        // ===========================================================
        let player;
        let input = { left: false, right: false };
        let lastGeneratedHeight = 0;
        
        function init() {
            player = new Player();
            
            // Установка рекорда
            recordScoreDisplay.textContent = highScore;
            recordDisplay.textContent = `РЕКОРД: ${highScore}`;
            
            // Кнопки
            startBtn.addEventListener('click', startGame);
            restartBtn.addEventListener('click', restartGame);
            menuBtn.addEventListener('click', showMenu);
            
            // Управление клавиатурой
            window.addEventListener('keydown', (e) => {
                switch(e.key) {
                    case 'ArrowLeft':
                    case 'a':
                        input.left = true;
                        break;
                    case 'ArrowRight':
                    case 'd':
                        input.right = true;
                        break;
                    case ' ':
                        if (gameState === GAME_STATES.MENU) startGame();
                        if (gameState === GAME_STATES.GAME_OVER) restartGame();
                        break;
                }
            });
            
            window.addEventListener('keyup', (e) => {
                switch(e.key) {
                    case 'ArrowLeft':
                    case 'a':
                        input.left = false;
                        break;
                    case 'ArrowRight':
                    case 'd':
                        input.right = false;
                        break;
                }
            });
            
            // Сенсорное управление
            leftBtn.addEventListener('touchstart', (e) => {
                input.left = true;
                e.preventDefault();
            });
            
            leftBtn.addEventListener('touchend', (e) => {
                input.left = false;
                e.preventDefault();
            });
            
            rightBtn.addEventListener('touchstart', (e) => {
                input.right = true;
                e.preventDefault();
            });
            
            rightBtn.addEventListener('touchend', (e) => {
                input.right = false;
                e.preventDefault();
            });
            
            // Мышь для десктопа
            leftBtn.addEventListener('mousedown', () => input.left = true);
            leftBtn.addEventListener('mouseup', () => input.left = false);
            leftBtn.addEventListener('mouseleave', () => input.left = false);
            
            rightBtn.addEventListener('mousedown', () => input.right = true);
            rightBtn.addEventListener('mouseup', () => input.right = false);
            rightBtn.addEventListener('mouseleave', () => input.right = false);
            
            // Генерация начальных платформ
            generateInitialPlatforms();
            
            // Запуск игрового цикла
            gameLoop();
        }
        
        // ===========================================================
        // ГЕНЕРАЦИЯ ПЛАТФОРМ И МОНЕТ
        // ===========================================================
        function generateInitialPlatforms() {
            platforms = [];
            coins = [];
            particles = [];
            lastGeneratedHeight = 0;
            
            // Начальная платформа под игроком
            platforms.push(new Platform(SCREEN_WIDTH / 2 - 40, 700, 'normal'));
            
            // Генерируем платформы снизу вверх
            for (let y = 600; y > -2000; y -= 80) {
                generatePlatformAtY(y);
            }
            
            // Генерируем монеты
            for (let y = 650; y > -2000; y -= 60) {
                if (Math.random() > 0.7) {
                    const x = 40 + Math.random() * (SCREEN_WIDTH - 80);
                    coins.push(new Coin(x, y));
                }
            }
            
            lastGeneratedHeight = -2000;
        }
        
        function generatePlatformAtY(y) {
            const x = 20 + Math.random() * (SCREEN_WIDTH - 100);
            let type = 'normal';
            
            if (Math.random() > 0.8) {
                const types = ['moving', 'breakable', 'spring'];
                type = types[Math.floor(Math.random() * types.length)];
            }
            
            platforms.push(new Platform(x, y, type));
        }
        
        function createParticles(x, y, count, color) {
            for (let i = 0; i < count; i++) {
                particles.push(new Particle(x, y, color));
            }
        }
        
        // ===========================================================
        // ОБНОВЛЕНИЕ ИГРЫ
        // ===========================================================
        function updateGame() {
            if (gameState !== GAME_STATES.PLAYING) return;
            
            // Обновляем игрока
            player.update(input);
            
            // Проверяем коллизии с платформами
            checkPlatformCollisions();
            
            // Обновляем камеру
            cameraY += (cameraTargetY - cameraY) * 0.1;
            
            // Обновляем монеты
            coins.forEach(coin => coin.update());
            
            // Обновляем частицы
            particles.forEach((particle, index) => {
                particle.update();
                if (particle.life <= 0) {
                    particles.splice(index, 1);
                }
            });
            
            // Обновляем движущиеся платформы
            platforms.forEach(platform => platform.update());
            
            // Проверяем сбор монет
            coins.forEach((coin, index) => {
                if (!coin.collected &&
                    player.x < coin.x + coin.width &&
                    player.x + player.width > coin.x &&
                    player.y < coin.y + coin.height &&
                    player.y + player.height > coin.y) {
                    
                    coin.collected = true;
                    score += 10;
                    createParticles(coin.x + coin.width/2, coin.y + coin.height/2, 8, '#FFD166');
                }
            });
            
            // Удаляем собранные монеты
            coins = coins.filter(coin => !coin.collected);
            
            // Генерация новых платформ и монет по мере продвижения вверх
            generateNewContent();
            
            // Проверка на проигрыш
            if (player.y - cameraY > SCREEN_HEIGHT + 100) {
                gameOver();
            }
            
            // Удаляем объекты, которые ушли далеко вниз (но не слишком рано!)
            removeOldObjects();
        }
        
        function generateNewContent() {
            // Генерируем новые платформы, если игрок поднялся достаточно высоко
            const playerWorldY = player.y + cameraY;
            
            if (playerWorldY < lastGeneratedHeight + 500) {
                // Генерируем новые платформы выше
                for (let y = lastGeneratedHeight - 100; y > lastGeneratedHeight - 1000; y -= 80) {
                    generatePlatformAtY(y);
                }
                
                // Генерируем новые монеты
                for (let y = lastGeneratedHeight - 50; y > lastGeneratedHeight - 1000; y -= 60) {
                    if (Math.random() > 0.7) {
                        const x = 40 + Math.random() * (SCREEN_WIDTH - 80);
                        coins.push(new Coin(x, y));
                    }
                }
                
                lastGeneratedHeight -= 1000;
            }
        }
        
        function removeOldObjects() {
            // Удаляем платформы и монеты, которые ушли далеко вниз (но с большим запасом!)
            const removeThreshold = cameraY + SCREEN_HEIGHT + 1500; // 1500 пикселей ниже экрана
            
            platforms = platforms.filter(p => p.y < removeThreshold);
            coins = coins.filter(c => c.y < removeThreshold || c.collected);
        }
        
        function checkPlatformCollisions() {
            const playerBottom = player.y + player.height;
            const playerLeft = player.x;
            const playerRight = player.x + player.width;
            
            for (const platform of platforms) {
                // Проверяем горизонтальное пересечение
                if (playerRight > platform.x && playerLeft < platform.x + platform.width) {
                    // Проверяем, приземлился ли игрок на платформу сверху
                    if (player.velY > 0 &&
                        playerBottom - player.velY <= platform.y &&
                        playerBottom >= platform.y) {
                        
                        // Приземление на платформу
                        player.y = platform.y - player.height;
                        player.velY = player.jumpPower;
                        player.grounded = true;
                        
                        // Эффекты и обработка типов платформ
                        if (platform.type === 'breakable') {
                            platform.health--;
                            if (platform.health <= 0) {
                                createParticles(platform.x + platform.width/2, platform.y, 8, '#FF6B6B');
                                const index = platforms.indexOf(platform);
                                platforms.splice(index, 1);
                            }
                        } else if (platform.type === 'spring') {
                            player.velY = player.jumpPower * 1.8;
                            createParticles(player.x + player.width/2, player.y + player.height, 12, '#4ECDC4');
                        } else {
                            createParticles(player.x + player.width/2, player.y + player.height, 6, '#FFD166');
                        }
                        
                        // Обновление камеры и счета
                        cameraTargetY = platform.y - SCREEN_HEIGHT * 0.7;
                        score = Math.max(score, Math.floor(-cameraTargetY / 10));
                        
                        break;
                    }
                }
            }
        }
        
        // ===========================================================
        // ОТРИСОВКА
        // ===========================================================
        function drawGame() {
            // Очищаем экран
            ctx.fillStyle = '#1a2a6c';
            ctx.fillRect(0, 0, SCREEN_WIDTH, SCREEN_HEIGHT);
            
            // Рисуем фон
            drawBackground();
            
            // Рисуем игровые объекты
            platforms.forEach(platform => platform.draw());
            coins.forEach(coin => coin.draw());
            particles.forEach(particle => particle.draw());
            player.draw();
            
            // Рисуем интерфейс
            drawUI();
        }
        
        function drawBackground() {
            // Градиентное небо
            const gradient = ctx.createLinearGradient(0, 0, 0, SCREEN_HEIGHT);
            gradient.addColorStop(0, '#87CEEB');
            gradient.addColorStop(1, '#1E90FF');
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, SCREEN_WIDTH, SCREEN_HEIGHT);
            
            // Облака
            drawCloud(100, 150 - cameraY * 0.05, 30);
            drawCloud(300, 80 - cameraY * 0.07, 40);
            drawCloud(150, 250 - cameraY * 0.03, 25);
            
            // Солнце
            const sunY = 100 - cameraY * 0.1;
            if (sunY > -50 && sunY < SCREEN_HEIGHT + 50) {
                ctx.fillStyle = '#FFD166';
                ctx.beginPath();
                ctx.arc(400, sunY, 30, 0, Math.PI * 2);
                ctx.fill();
            }
        }
        
        function drawCloud(x, y, size) {
            if (y > SCREEN_HEIGHT + 100 || y < -100) return;
            
            ctx.fillStyle = 'rgba(255, 255, 255, 0.8)';
            ctx.beginPath();
            ctx.arc(x, y, size, 0, Math.PI * 2);
            ctx.arc(x + size * 0.8, y - size * 0.4, size * 0.7, 0, Math.PI * 2);
            ctx.arc(x + size * 1.5, y, size * 0.8, 0, Math.PI * 2);
            ctx.fill();
        }
        
        function drawUI() {
            if (gameState === GAME_STATES.PLAYING) {
                // Счет
                ctx.fillStyle = '#FFFFFF';
                ctx.font = 'bold 30px Arial';
                ctx.textAlign = 'center';
                ctx.fillText(`ВЫСОТА: ${score}`, SCREEN_WIDTH / 2, 40);
                
                if (score < highScore) {
                    ctx.fillStyle = '#FFD166';
                    ctx.font = 'bold 24px Arial';
                    ctx.fillText(`РЕКОРД: ${highScore}`, SCREEN_WIDTH / 2, 70);
                }
            }
        }
        
        // ===========================================================
        // УПРАВЛЕНИЕ ИГРОЙ
        // ===========================================================
        function startGame() {
            menuScreen.classList.add('hidden');
            gameOverScreen.classList.add('hidden');
            recordDisplay.classList.remove('hidden');
            gameState = GAME_STATES.PLAYING;
            
            // Сброс игры
            score = 0;
            cameraY = 0;
            cameraTargetY = 0;
            player.reset();
            
            generateInitialPlatforms();
        }
        
        function restartGame() {
            gameOverScreen.classList.add('hidden');
            gameState = GAME_STATES.PLAYING;
            
            score = 0;
            cameraY = 0;
            cameraTargetY = 0;
            player.reset();
            
            generateInitialPlatforms();
        }
        
        function showMenu() {
            gameOverScreen.classList.add('hidden');
            menuScreen.classList.remove('hidden');
            recordDisplay.classList.add('hidden');
            gameState = GAME_STATES.MENU;
        }
        
        function gameOver() {
            gameState = GAME_STATES.GAME_OVER;
            
            // Обновление рекорда
            if (score > highScore) {
                highScore = score;
                localStorage.setItem('doodleJumpHighScore', highScore);
            }
            
            // Обновление отображения
            finalScoreDisplay.textContent = score;
            recordScoreDisplay.textContent = highScore;
            recordDisplay.textContent = `РЕКОРД: ${highScore}`;
            
            gameOverScreen.classList.remove('hidden');
        }
        
        // ===========================================================
        // ИГРОВОЙ ЦИКЛ
        // ===========================================================
        function gameLoop() {
            updateGame();
            drawGame();
            requestAnimationFrame(gameLoop);
        }
        
        // Запуск игры
        window.addEventListener('load', init);
	</script>
</body>

</html>